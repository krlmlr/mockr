<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mocking in R • mockr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Mocking in R">
<meta property="og:description" content="Provides a means to mock a package function, i.e., temporarily substitute it for testing. Designed as a drop-in replacement for the now deprecated testthat::with_mock() and testthat::local_mock().">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">mockr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/mockr.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/krlmlr/mockr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="mockr">mockr<a class="anchor" aria-label="anchor" href="#mockr"></a>
</h1></div>
<!-- badges: start -->

<!-- badges: end -->
<p>The goal of mockr is to provide a drop-in replacement for <a href="https://testthat.r-lib.org/reference/with_mock.html" class="external-link"><code>testthat::local_mock()</code></a> and <a href="https://testthat.r-lib.org/reference/with_mock.html" class="external-link"><code>testthat::with_mock()</code></a> which is deprecated in testthat 3.0.0. The functions <a href="https://krlmlr.github.io/mockr/reference/local_mock.html"><code>mockr::local_mock()</code></a> and <a href="https://krlmlr.github.io/mockr/reference/local_mock.html"><code>mockr::with_mock()</code></a> are modeled closely after the original implementation, but now only allow mocking functions in the package under test. In contrast to the original implementation, no fiddling with R’s internals is needed, and the implementation plays well with byte-compiled code. There are some caveats, though:</p>
<ol style="list-style-type: decimal">
<li>Mocking external functions (in other packages) doesn’t work anymore. This is by design.
<ul>
<li>If you need to mock an external function, write a wrapper.</li>
<li>If that external function is called by third-party code, you’ll need to perhaps mock that third-party code, or look for a different way of implementing this test or organizing your code.</li>
</ul>
</li>
<li>You cannot refer to functions in your package via <code>your.package::</code> or <code>your.package:::</code> anymore.
<ul>
<li>Remove the <code>your.package:::</code>, your code and tests should run just fine without that.</li>
</ul>
</li>
</ol>
<p>If you encounter other problems, please <a href="https://github.com/krlmlr/mockr/issues" class="external-link">file an issue</a>.</p>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<pre class="chroma">
<span class="kr"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="o">(</span><span class="nv"><a href="https://krlmlr.github.io/mockr/">mockr</a></span><span class="o">)</span>

<span class="nv">access_resource</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="nf"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="o">(</span><span class="s">"Trying to access resource..."</span><span class="o">)</span>
  <span class="c"># For some reason we can't access the resource in our tests.</span>
  <span class="kr"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="o">(</span><span class="s">"Can't access resource now."</span><span class="o">)</span>
<span class="o">}</span>

<span class="nv">work_with_resource</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="o">(</span><span class="o">)</span> <span class="o">{</span>
  <span class="nv">resource</span> <span class="o">&lt;-</span> <span class="nf">access_resource</span><span class="o">(</span><span class="o">)</span>
  <span class="nf"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="o">(</span><span class="s">"Fetched resource: "</span>, <span class="nv">resource</span><span class="o">)</span>
  <span class="nf"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="o">(</span><span class="nv">resource</span><span class="o">)</span>
<span class="o">}</span>

<span class="c"># Calling this function gives an error</span>
<span class="nf">work_with_resource</span><span class="o">(</span><span class="o">)</span>
<span class="c">#&gt; Trying to access resource...</span>
<span class="c">#&gt; Error in access_resource(): Can't access resource now.</span>

<span class="nf"><a href="https://rdrr.io/r/base/eval.html" class="external-link">local</a></span><span class="o">(</span><span class="o">{</span>
  <span class="c"># Here, we override the function that raises the error</span>
  <span class="nf"><a href="https://krlmlr.github.io/mockr/reference/local_mock.html">local_mock</a></span><span class="o">(</span>access_resource <span class="o">=</span> <span class="kr">function</span><span class="o">(</span><span class="o">)</span> <span class="m">42</span><span class="o">)</span>

  <span class="c"># No error raised</span>
  <span class="nf">work_with_resource</span><span class="o">(</span><span class="o">)</span>
<span class="o">}</span><span class="o">)</span>
<span class="c">#&gt; Fetched resource: 42</span></pre>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install from CRAN via</p>
<pre class="chroma">
<span class="nf"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="o">(</span><span class="s">"mockr"</span><span class="o">)</span></pre>
<hr>
</div>
<div class="section level2">
<h2 id="code-of-conduct">Code of Conduct<a class="anchor" aria-label="anchor" href="#code-of-conduct"></a>
</h2>
<p>Please note that the mockr project is released with a <a href="https://krlmlr.github.io/mockr/CODE_OF_CONDUCT.html">Contributor Code of Conduct</a>. By contributing to this project, you agree to abide by its terms.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=mockr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/krlmlr/mockr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/krlmlr/mockr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing mockr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://krlmlr.info" class="external-link">Kirill Müller</a> <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/krlmlr/mockr/actions" class="external-link"><img src="https://github.com/krlmlr/mockr/workflows/rcc/badge.svg" alt="rcc"></a></li>
<li><a href="https://cran.r-project.org/package=mockr" class="external-link"><img src="https://www.r-pkg.org/badges/version/mockr" alt="CRAN_Status_Badge"></a></li>
<li><a href="https://app.codecov.io/gh/krlmlr/mockr?branch=main" class="external-link"><img src="https://codecov.io/gh/krlmlr/mockr/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://krlmlr.info" class="external-link">Kirill Müller</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

      </footer>
</div>






  </body>
</html>
